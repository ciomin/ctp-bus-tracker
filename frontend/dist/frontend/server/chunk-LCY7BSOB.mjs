import './polyfills.server.mjs';
import{$ as ge,A as q,B as L,C as z,D as J,E as Y,F as x,G as ee,H as C,I as P,J as te,K as S,R as ie,T as se,U as ne,V as I,W as ae,X as re,Y as oe,Z as le,_ as he,a as T,aa as ce,b as Z,ba as de,c as j,d as B,e as N,ea as pe,f as G,g as V,h as W,i as g,j as U,k as H,ka as ue,l as $,m as K,n as Q,o as f,p as X,q as c,r as h,s as D,t as y,u as M,v as E,w as O,x as v,y as d,z as b}from"./chunk-EMSEKZAN.mjs";import{a as F,b as R,h as k}from"./chunk-KRLCULJA.mjs";var we=["*"],A=class{_clearListeners(){for(let s of this._listeners)s.remove();this._listeners=[]}constructor(s){this._ngZone=s,this._pending=[],this._listeners=[],this._targetStream=new Z(void 0)}getLazyEmitter(s){return this._targetStream.pipe(G(r=>{let e=new T(t=>{if(!r){this._pending.push({observable:e,observer:t});return}let i=r.addListener(s,n=>{this._ngZone.run(()=>t.next(n))});if(!i){t.complete();return}return this._listeners.push(i),()=>i.remove()});return e}))}setTarget(s){let r=this._targetStream.value;s!==r&&(r&&(this._clearListeners(),this._pending=[]),this._targetStream.next(s),this._pending.forEach(e=>e.observable.subscribe(e.observer)),this._pending=[])}destroy(){this._clearListeners(),this._pending=[],this._targetStream.complete()}},p={center:{lat:37.421995,lng:-122.084092},zoom:17,mapTypeId:"roadmap"},me="500px",_e="500px",w=(()=>{let s=class s{set center(e){this._center=e}set zoom(e){this._zoom=e}set options(e){this._options=e||p}constructor(e,t,i){if(this._elementRef=e,this._ngZone=t,this._eventManager=new A(W(y)),this.height=me,this.width=_e,this._options=p,this.mapInitialized=new D,this.authFailure=new D,this.boundsChanged=this._eventManager.getLazyEmitter("bounds_changed"),this.centerChanged=this._eventManager.getLazyEmitter("center_changed"),this.mapClick=this._eventManager.getLazyEmitter("click"),this.mapDblclick=this._eventManager.getLazyEmitter("dblclick"),this.mapDrag=this._eventManager.getLazyEmitter("drag"),this.mapDragend=this._eventManager.getLazyEmitter("dragend"),this.mapDragstart=this._eventManager.getLazyEmitter("dragstart"),this.headingChanged=this._eventManager.getLazyEmitter("heading_changed"),this.idle=this._eventManager.getLazyEmitter("idle"),this.maptypeidChanged=this._eventManager.getLazyEmitter("maptypeid_changed"),this.mapMousemove=this._eventManager.getLazyEmitter("mousemove"),this.mapMouseout=this._eventManager.getLazyEmitter("mouseout"),this.mapMouseover=this._eventManager.getLazyEmitter("mouseover"),this.projectionChanged=this._eventManager.getLazyEmitter("projection_changed"),this.mapRightclick=this._eventManager.getLazyEmitter("rightclick"),this.tilesloaded=this._eventManager.getLazyEmitter("tilesloaded"),this.tiltChanged=this._eventManager.getLazyEmitter("tilt_changed"),this.zoomChanged=this._eventManager.getLazyEmitter("zoom_changed"),this._isBrowser=ae(i),this._isBrowser){let n=window;n.google,this._existingAuthFailureCallback=n.gm_authFailure,n.gm_authFailure=()=>{this._existingAuthFailureCallback&&this._existingAuthFailureCallback(),this.authFailure.emit()}}}ngOnChanges(e){(e.height||e.width)&&this._setSize();let t=this.googleMap;t&&(e.options&&t.setOptions(this._combineOptions()),e.center&&this._center&&t.setCenter(this._center),e.zoom&&this._zoom!=null&&t.setZoom(this._zoom),e.mapTypeId&&this.mapTypeId&&t.setMapTypeId(this.mapTypeId))}ngOnInit(){this._isBrowser&&(this._mapEl=this._elementRef.nativeElement.querySelector(".map-container"),this._setSize(),this._ngZone.runOutsideAngular(()=>{this.googleMap=new google.maps.Map(this._mapEl,this._combineOptions())}),this._eventManager.setTarget(this.googleMap),this.mapInitialized.emit(this.googleMap))}ngOnDestroy(){if(this._eventManager.destroy(),this._isBrowser){let e=window;e.gm_authFailure=this._existingAuthFailureCallback}}fitBounds(e,t){this._assertInitialized(),this.googleMap.fitBounds(e,t)}panBy(e,t){this._assertInitialized(),this.googleMap.panBy(e,t)}panTo(e){this._assertInitialized(),this.googleMap.panTo(e)}panToBounds(e,t){this._assertInitialized(),this.googleMap.panToBounds(e,t)}getBounds(){return this._assertInitialized(),this.googleMap.getBounds()||null}getCenter(){return this._assertInitialized(),this.googleMap.getCenter()}getClickableIcons(){return this._assertInitialized(),this.googleMap.getClickableIcons()}getHeading(){return this._assertInitialized(),this.googleMap.getHeading()}getMapTypeId(){return this._assertInitialized(),this.googleMap.getMapTypeId()}getProjection(){return this._assertInitialized(),this.googleMap.getProjection()||null}getStreetView(){return this._assertInitialized(),this.googleMap.getStreetView()}getTilt(){return this._assertInitialized(),this.googleMap.getTilt()}getZoom(){return this._assertInitialized(),this.googleMap.getZoom()}get controls(){return this._assertInitialized(),this.googleMap.controls}get data(){return this._assertInitialized(),this.googleMap.data}get mapTypes(){return this._assertInitialized(),this.googleMap.mapTypes}get overlayMapTypes(){return this._assertInitialized(),this.googleMap.overlayMapTypes}_setSize(){if(this._mapEl){let e=this._mapEl.style;e.height=this.height===null?"":fe(this.height)||me,e.width=this.width===null?"":fe(this.width)||_e}}_combineOptions(){let e=this._options||{};return R(F({},e),{center:this._center||e.center||p.center,zoom:this._zoom??e.zoom??p.zoom,mapTypeId:this.mapTypeId||e.mapTypeId||p.mapTypeId})}_assertInitialized(){this.googleMap}};s.\u0275fac=function(t){return new(t||s)(h(f),h(y),h(Q))},s.\u0275cmp=g({type:s,selectors:[["google-map"]],inputs:{height:"height",width:"width",mapTypeId:"mapTypeId",center:"center",zoom:"zoom",options:"options"},outputs:{mapInitialized:"mapInitialized",authFailure:"authFailure",boundsChanged:"boundsChanged",centerChanged:"centerChanged",mapClick:"mapClick",mapDblclick:"mapDblclick",mapDrag:"mapDrag",mapDragend:"mapDragend",mapDragstart:"mapDragstart",headingChanged:"headingChanged",idle:"idle",maptypeidChanged:"maptypeidChanged",mapMousemove:"mapMousemove",mapMouseout:"mapMouseout",mapMouseover:"mapMouseover",projectionChanged:"projectionChanged",mapRightclick:"mapRightclick",tilesloaded:"tilesloaded",tiltChanged:"tiltChanged",zoomChanged:"zoomChanged"},exportAs:["googleMap"],features:[H],ngContentSelectors:we,decls:2,vars:0,consts:[[1,"map-container"]],template:function(t,i){t&1&&(J(),b(0,"div",0),Y(1))},encapsulation:2,changeDetection:0});let a=s;return a})(),ke=/([A-Za-z%]+)$/;function fe(a){return a==null?"":ke.test(a)?a:`${a}px`}var Me=(()=>{let s=class s{};s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=U({type:s}),s.\u0275inj=V({});let a=s;return a})();function Ee(a,s){if(a&1){let r=q();v(0,"li",2),L("click",function(){let i=$(r).$implicit,n=z(2);return K(n.selectRoute(i.id))}),x(1),d()}if(a&2){let r=s.$implicit,e=z(2);E("selected",r.id===e.selectedRouteId),c(1),ee(" ",r.shortName,": ",r.longName," ")}}function Oe(a,s){if(a&1&&(v(0,"ul"),O(1,Ee,2,4,"li",4),d()),a&2){let r=z();c(1),M("ngForOf",r.routes)}}var ve=(()=>{let s=class s{constructor(e,t,i){this.renderer=e,this.el=t,this.http=i,this.apiKey="6vvrXArXKuazfWKpaSXPw5OmCnqHvi6w1yxs05w4",this.apiBaseUrl="https://api.tranzy.dev/v1/opendata",this.markers=[],this.httpOptions={headers:new re({"X-Agency-Id":"2",Accept:"application/json","Access-Control-Allow-Origin":"*","X-API-KEY":this.apiKey})},this.routes=[],this.center={lat:46.7712,lng:23.6236},this.zoom=13,this.options={streetViewControl:!1,mapTypeControl:!1,fullscreenControl:!1,maxZoom:16,minZoom:13},this.showRoutesMenu=!1,this.allTrips=[],this.allShapes=[],this.allStops=[],this.allVehicles=[],this.selectedRouteId=null,this.selectedTrips=[],this.selectedShapes=[],this.selectedStops=[],this.selectedVehicles=[],this.shapePolylines=[],this.stopMarkers=[],this.vehicleMarkers=[]}move(e){e.latLng!=null&&(this.display=e.latLng.toJSON())}ngOnInit(){this.fetchAllData(),this.fetchRoutes()}fetchRoutes(){return k(this,null,function*(){this.http.get(`${this.apiBaseUrl}/routes`,this.httpOptions).subscribe(e=>{this.routes=e.map(t=>({id:t.route_id,shortName:t.route_short_name,longName:t.route_long_name}))},e=>{console.error("Error fetching routes:",e)})})}toggleRoutesMenu(){this.showRoutesMenu=!this.showRoutesMenu}fetchAllData(){B({trips:this.fetchAllTrips(),shapes:this.fetchAllShapes(),stops:this.fetchAllStops(),vehicles:this.fetchAllVehicles()}).subscribe(e=>{this.allTrips=e.trips,this.allShapes=e.shapes,this.allStops=e.stops,this.allVehicles=e.vehicles},e=>{console.error("Error fetching data:",e)})}fetchAllTrips(){return this.http.get(`${this.apiBaseUrl}/trips`,this.httpOptions)}fetchAllShapes(){return this.http.get(`${this.apiBaseUrl}/shapes`,this.httpOptions)}fetchAllStops(){return this.http.get(`${this.apiBaseUrl}/stops`,this.httpOptions)}fetchAllVehicles(){return this.http.get(`${this.apiBaseUrl}/vehicles`,this.httpOptions)}selectRoute(e){if(this.clearMapData(),e===this.selectedRouteId){this.selectedRouteId=null,this.selectedTrips=[],this.selectedShapes=[],this.selectedStops=[],this.selectedVehicles=[],this.showRoutesMenu=!1;return}this.selectedRouteId=e,this.selectedTrips=this.allTrips.filter(i=>i.route_id===e);let t=[...new Set(this.selectedTrips.map(i=>i.shape_id))];this.selectedShapes=t.flatMap(i=>this.allShapes.filter(n=>n.shape_id===i)),this.selectedStops=this.allStops,this.selectedVehicles=this.allVehicles.filter(i=>i.route_id===e&&i.trip_id!=null),this.updateShapesOnMap(this.selectedShapes),this.updateVehiclesOnMap(this.selectedVehicles),this.updateStopsOnMap(this.selectedStops),this.showRoutesMenu=!1}clearMapData(){this.shapePolylines.forEach(e=>e.setMap(null)),this.shapePolylines=[],this.stopMarkers.forEach(e=>e.setMap(null)),this.stopMarkers=[],this.vehicleMarkers.forEach(e=>e.setMap(null)),this.vehicleMarkers=[]}groupShapesByShapeId(e){return e.reduce((i,n)=>(i[n.shape_id]||(i[n.shape_id]=[]),i[n.shape_id].push(n),i),{})}updateShapesOnMap(e){let t=this.groupShapesByShapeId(e);Object.keys(t).forEach(i=>{let n=t[i],o=i.endsWith("_0")?"#0000FF":"#FF0000",u=[{icon:{path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW},offset:"100%",repeat:"100px"}],m=new google.maps.Polyline({path:n.map(_=>({lat:_.shape_pt_lat,lng:_.shape_pt_lon})),geodesic:!0,strokeColor:o,strokeOpacity:.8,strokeWeight:2,icons:u});this.mapElement&&this.mapElement.googleMap&&m.setMap(this.mapElement.googleMap),this.shapePolylines.push(m)})}createCustomMarkerIcon(e){let t=document.createElement("canvas");t.width=30,t.height=30;let i=t.getContext("2d");if(i&&(i.fillStyle="black",i.beginPath(),i.arc(15,15,15,0,Math.PI*2),i.fill(),i.fillStyle="yellow",i.font="12px Arial",i.textAlign="center",i.textBaseline="middle"),i){let n=i.measureText(e).width;i.fillText(e,15,15)}return t.toDataURL()}updateVehiclesOnMap(e){e.forEach(t=>{let i=this.vehicleMarkers.find(n=>n.getLabel()===t.id);if(i)i.setPosition(new google.maps.LatLng(t.latitude,t.longitude));else{let n=this.routes.find(u=>u.id===t.route_id),l=n?n.shortName:"Unknown",o=this.createCustomMarkerIcon(l);i=new google.maps.Marker({position:{lat:t.latitude,lng:t.longitude},map:this.mapElement.googleMap,icon:o,label:t.id}),this.vehicleMarkers.push(i)}})}updateStopsOnMap(e){let t=(n,l,o=1e-4)=>Math.abs(n.lat-l.lat)<o&&Math.abs(n.lng-l.lng)<o,i=this.selectedShapes;e.forEach(n=>{let l=i.filter(o=>t({lat:o.shape_pt_lat,lng:o.shape_pt_lon},{lat:n.stop_lat,lng:n.stop_lon}));if(l.length>0){let m=l[0].shape_id.endsWith("_0")?"#0000FF":"#FF0000",_=new google.maps.Marker({position:{lat:n.stop_lat,lng:n.stop_lon},map:this.mapElement.googleMap,icon:{path:google.maps.SymbolPath.CIRCLE,scale:8,fillColor:m,fillOpacity:1,strokeWeight:2,strokeColor:"white"},title:n.stop_name});this.stopMarkers.push(_)}})}getData(e){return k(this,null,function*(){return this.http.get(`${this.apiBaseUrl}/vehicles?vehicle_id=${e}`,this.httpOptions).pipe(N(t=>(console.error("Error fetching vehicle data:",t),j("Error fetching vehicle data."))))})}log(e){console.log(e)}};s.\u0275fac=function(t){return new(t||s)(h(X),h(f),h(oe))},s.\u0275cmp=g({type:s,selectors:[["app-map"]],viewQuery:function(t,i){if(t&1&&te(w,5),t&2){let n;P(n=S())&&(i.mapElement=n.first)}},standalone:!0,features:[C],decls:5,vars:5,consts:[[3,"center","zoom"],["mapElement",""],[3,"click"],[4,"ngIf"],[3,"selected","click",4,"ngFor","ngForOf"]],template:function(t,i){t&1&&(v(0,"google-map",0,1)(2,"button",2),L("click",function(){return i.toggleRoutesMenu()}),x(3," Lines "),d(),O(4,Oe,2,1,"ul",3),d()),t&2&&(M("center",i.center)("zoom",i.zoom),c(2),E("active",i.selectedRouteId!==null),c(2),M("ngIf",i.showRoutesMenu))},dependencies:[I,se,ne,Me,w,ge],styles:["button[_ngcontent-%COMP%]{position:absolute;top:10px;left:10px;z-index:1000}ul[_ngcontent-%COMP%]{list-style:none;position:absolute;top:50px;left:10px;z-index:1000;background-color:#fff;padding:10px;border:1px solid #ccc;border-radius:5px;max-height:300px;overflow-y:auto}li[_ngcontent-%COMP%]{padding:5px;cursor:pointer}li[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.selected[_ngcontent-%COMP%]{background-color:#f0f0f0;color:#333}button.active[_ngcontent-%COMP%]{background-color:#007bff;color:#fff}"]});let a=s;return a})();var be=(()=>{let s=class s{constructor(){this.title="frontend"}};s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=g({type:s,selectors:[["app-root"]],standalone:!0,features:[C],decls:1,vars:0,template:function(t,i){t&1&&b(0,"app-map")},dependencies:[I,ve]});let a=s;return a})();var ze=[];var Ce={providers:[le(he()),ue(ze),de()]};var Le={providers:[pe()]},Ie=ie(Ce,Le);var xe=()=>ce(be,Ie),Et=xe;export{Et as a};
